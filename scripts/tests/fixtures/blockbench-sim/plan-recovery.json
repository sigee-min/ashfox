{
  "name": "plan-recovery",
  "project": {
    "format": "geckolib",
    "name": "Plan Recovery",
    "textureResolution": { "width": 16, "height": 16 },
    "cubes": [
      { "id": "cube-1", "name": "cube", "from": [0, 0, 0], "to": [16, 16, 16], "bone": "root" }
    ],
    "textures": [
      { "id": "tex-1", "name": "tex", "width": 16, "height": 16 }
    ]
  },
  "steps": [
    {
      "op": "assign_texture",
      "payload": { "textureName": "tex", "cubeNames": ["cube"] },
      "expect": [{ "path": "ok", "equals": true }]
    },
    {
      "op": "set_face_uv",
      "payload": { "cubeName": "cube", "faces": { "north": [0, 0, 8, 16], "south": [8, 0, 16, 8] } },
      "expect": [{ "path": "ok", "equals": true }]
    },
    {
      "op": "preflight_texture",
      "payload": { "includeUsage": true },
      "capture": [{ "name": "preUvUsageId", "path": "data.uvUsageId" }],
      "expect": [
        { "path": "ok", "equals": true },
        { "path": "data.uvUsageId", "defined": true }
      ]
    },
    {
      "op": "texture_pipeline",
      "payload": {
        "textures": [
          { "mode": "update", "targetName": "tex", "width": 16, "height": 16, "background": "#00ff00" }
        ]
      },
      "expect": [
        { "path": "ok", "equals": true },
        { "path": "data.steps.textures.recovery.method", "equals": "plan" },
        { "path": "data.steps.textures.recovery.reason", "equals": "uv_scale_mismatch" },
        { "path": "data.steps.textures.uvUsageId", "defined": true },
        { "path": "data.steps.textures.uvUsageId", "notEquals": { "ref": "preUvUsageId" } }
      ]
    }
  ]
}
